name: K1/K1 Max WebSocket to MQTT Bridge
version: "0.2.1"
slug: k1max_ws_bridge
description: Connects to a Creality K1/K1 Max WebSocket and exposes temps, progress, and time remaining via MQTT Discovery.
url: "https://github.com/BZPJoe/k1max-ws-bridge-repo"
arch:
  - amd64
  - aarch64
startup: services
boot: auto
init: false
host_network: true
options:
  ws_url: "ws://192.168.0.41/websocket"
  ws_headers: {}
  base_topic: "k1max"
  device_name: "Creality K1 Max"
  device_id: "k1max_3d_printer"
  mqtt:
    host: "core-mosquitto"
    port: 1883
    username: "homeassistant"
    password: "changeme"
    discovery_prefix: "homeassistant"
  debug:
    log_raw_frames: false
    raw_frames_limit: 0
  mappings:
    - name: Time Left
      unique_id: k1max_time_left
      jsonpath: "$.printLeftTime"
      unit: "s"
      device_class: duration
      state_class: measurement
      icon: mdi:timer-sand
      transform: "seconds_to_hms"

    - name: Time Elapsed
      unique_id: k1max_time_elapsed
      jsonpath: "$.printJobTime"
      unit: "s"
      device_class: duration
      state_class: measurement
      icon: mdi:timer-outline
      transform: "seconds_to_hms"

    - name: Progress
      unique_id: k1max_progress
      jsonpath: "$.printProgress"
      unit: "%"
      state_class: measurement
      icon: mdi:progress-clock
      transform: "none"

    - name: State Code
      unique_id: k1max_state_code
      jsonpath: "$.state"
      unit: ""
      icon: mdi:printer-3d
      transform: "none"

    - name: Nozzle Temp
      unique_id: k1max_nozzle_temp
      jsonpath: "$.nozzleTemp"
      unit: "°C"
      device_class: temperature
      state_class: measurement
      icon: mdi:thermometer
      transform: "none"

    - name: Bed Temp
      unique_id: k1max_bed_temp
      jsonpath: "$.bedTemp0"
      unit: "°C"
      device_class: temperature
      state_class: measurement
      icon: mdi:radiator
      transform: "none"

    - name: Current Layer
      unique_id: k1max_layer
      jsonpath: "$.layer"
      unit: ""
      icon: mdi:layers
      transform: "none"

    - name: Total Layers
      unique_id: k1max_total_layers
      jsonpath: "$.TotalLayer"
      unit: ""
      icon: mdi:layers-outline
      transform: "none"

    - name: Position XYZ
      unique_id: k1max_position
      jsonpath: "$.curPosition"
      unit: ""
      icon: mdi:axis-arrow
      transform: "none"

    - name: Used Material Length
      unique_id: k1max_used_material_mm
      jsonpath: "$.usedMaterialLength"
      unit: "mm"
      state_class: measurement
      icon: mdi:printer-3d-nozzle
      transform: "none"
schema:
  ws_url: str
  ws_headers: dict
  base_topic: str
  device_name: str
  device_id: str
  mqtt:
    host: str
    port: int
    username: str
    password: str
    discovery_prefix: str
  debug:
    log_raw_frames: bool
    raw_frames_limit: int
  mappings:
    - name: str
      unique_id: str
      jsonpath: str
      unit: str
      device_class: str
      state_class: str
      icon: str
      transform: str
